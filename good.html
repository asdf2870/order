<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ç›¤é»åŒæ­¥å·¥å…·</title>
<script src="https://cdn.tailwindcss.com"></script>

<!-- Firebase -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import { getFirestore, doc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

/* ğŸ”¥ ä½ çš„ Firebase è¨­å®š */
const firebaseConfig = {
  apiKey: "AIzaSyBzWK76cZTIKEoJGoc9bqi0M4sGLIMsUaE",
  authDomain: "good-e9e4e.firebaseapp.com",
  projectId: "good-e9e4e",
  storageBucket: "good-e9e4e.firebasestorage.app",
  messagingSenderId: "878748843198",
  appId: "1:878748843198:web:6183a33453463ef8e2b2ef"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

let currentCode = localStorage.getItem("syncCode");
let unsubscribe = null;

async function init() {
  await signInAnonymously(auth);

  onAuthStateChanged(auth, (user) => {
    if (!user) return;

    if (!currentCode) {
      currentCode = user.uid.substring(0,8);
      localStorage.setItem("syncCode", currentCode);
    }

    document.getElementById("code").innerText = currentCode;
    startSync();
    document.getElementById("loader").classList.add("hidden");
  });
}

function startSync() {
  if (unsubscribe) unsubscribe();

  const ref = doc(db, "inventory", currentCode);

  unsubscribe = onSnapshot(ref, (snap) => {
    if (snap.exists()) {
      document.getElementById("count").innerText = snap.data().count;
    }
  });
}

async function updateCount(value) {
  const ref = doc(db, "inventory", currentCode);
  const newValue = parseFloat(document.getElementById("count").innerText) + value;
  await setDoc(ref, { count: newValue });
}

async function resetCount() {
  const ref = doc(db, "inventory", currentCode);
  await setDoc(ref, { count: 0 });
}

window.updateCount = updateCount;
window.resetCount = resetCount;

init();
</script>
</head>

<body class="bg-gray-100 flex items-center justify-center min-h-screen">

<div id="loader" class="fixed inset-0 flex items-center justify-center bg-white z-50 text-xl">
  æ­£åœ¨é€£æ¥é›²ç«¯è³‡æ–™åº«...
</div>

<div class="bg-white p-8 rounded-2xl shadow-lg w-80 text-center space-y-6">

  <h1 class="text-2xl font-bold">ç›¤é»åŒæ­¥å·¥å…·</h1>

  <div class="text-sm text-gray-500">
    åŒæ­¥ç¢¼ï¼š<span id="code" class="font-bold text-blue-600"></span>
  </div>

  <div class="flex items-center justify-center space-x-4">
    <button onclick="updateCount(-0.5)" class="px-4 py-2 bg-gray-200 rounded-xl text-lg">-0.5</button>

    <div id="count" class="text-4xl font-bold w-20 text-center">0</div>

    <button onclick="updateCount(0.5)" class="px-4 py-2 bg-gray-200 rounded-xl text-lg">+0.5</button>
  </div>

  <button onclick="resetCount()" class="w-full py-2 bg-red-500 text-white rounded-xl">
    ä¸€éµæ­¸é›¶
  </button>

</div>

</body>
</html>
