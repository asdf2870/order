<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ç›¤é»è£œè²¨è¨ˆç®—å·¥å…·</title>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<script src="https://unpkg.com/lucide@latest"></script>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database-compat.js"></script>

</head>
<body class="bg-slate-100">
<div id="root"></div>

<script type="text/babel">
const { useState, useEffect, useMemo } = React;

/* ğŸ”¥ Firebase configï¼ˆä½ çš„ï¼‰ */
firebase.initializeApp({
  apiKey: "AIzaSyDS7PQrDh05bIGu9WYCcFM0s1GvhzDwz4M",
  authDomain: "order-718b1.firebaseapp.com",
  projectId: "order-718b1",
  storageBucket: "order-718b1.firebasestorage.app",
  messagingSenderId: "454465000018",
  appId: "1:454465000018:web:ac7c787ba3e423a2a1458b",
  databaseURL: "https://order-718b1-default-rtdb.asia-southeast1.firebasedatabase.app/"
});

const db = firebase.database();
const itemsRef = db.ref("inventory/items");

const App = () => {
  const [items, setItems] = useState([]);
  const [stockCounts, setStockCounts] = useState({});
  const [dayType, setDayType] = useState("weekday");

  /* ğŸ“¥ è®€å– Firebaseï¼ˆå³æ™‚åŒæ­¥ï¼‰ */
  useEffect(() => {
    itemsRef.on("value", snap => {
      const data = snap.val();
      setItems(data ? Object.values(data) : []);
    });
    return () => itemsRef.off();
  }, []);

  /* âœï¸ å¯«å…¥ Firebase */
  const saveItems = (newItems) => {
    const obj = {};
    newItems.forEach(i => obj[i.id] = i);
    itemsRef.set(obj);
  };

  const addItem = () => {
    const newItem = {
      id: Date.now(),
      name: "",
      weekdayMin: 0,
      weekendMin: 0,
      unit: "",
      shouldRound: false
    };
    saveItems([...items, newItem]);
  };

  const updateItem = (id, field, value) => {
    saveItems(items.map(i => i.id === id ? { ...i, [field]: value } : i));
  };

  const deleteItem = (id) => {
    if(confirm("ç¢ºå®šåˆªé™¤ï¼Ÿ")) {
      saveItems(items.filter(i => i.id !== id));
    }
  };

  const calcNeed = (item) => {
    const min = dayType === "weekday" ? item.weekdayMin : item.weekendMin;
    const cur = parseFloat(stockCounts[item.id] || 0);
    const need = min - cur;
    return need > 0 ? (item.shouldRound ? Math.round(need) : need.toFixed(2)) : 0;
  };

  return (
    <div className="max-w-xl mx-auto p-4 bg-white shadow-xl min-h-screen">
      <h1 className="text-xl font-bold mb-4">ğŸ“¦ è£œè²¨è¨ˆç®—ï¼ˆå³æ™‚åŒæ­¥ï¼‰</h1>

      <div className="flex gap-2 mb-4">
        <button onClick={()=>setDayType("weekday")} className={`flex-1 p-2 ${dayType==="weekday"?"bg-blue-600 text-white":"bg-slate-200"}`}>å¹³æ—¥</button>
        <button onClick={()=>setDayType("weekend")} className={`flex-1 p-2 ${dayType==="weekend"?"bg-orange-600 text-white":"bg-slate-200"}`}>å‡æ—¥</button>
      </div>

      {items.map(item => (
        <div key={item.id} className="border p-2 rounded mb-2">
          <input value={item.name} onChange={e=>updateItem(item.id,"name",e.target.value)} placeholder="å“é …" className="w-full font-bold mb-1"/>
          <div className="flex gap-2 text-sm">
            <input type="number" value={item.weekdayMin} onChange={e=>updateItem(item.id,"weekdayMin",+e.target.value)} placeholder="å¹³æ—¥æ¨™" className="w-1/3"/>
            <input type="number" value={item.weekendMin} onChange={e=>updateItem(item.id,"weekendMin",+e.target.value)} placeholder="å‡æ—¥æ¨™" className="w-1/3"/>
            <input placeholder="å–®ä½" value={item.unit} onChange={e=>updateItem(item.id,"unit",e.target.value)} className="w-1/3"/>
          </div>
          <div className="flex gap-2 mt-2">
            <input type="number" placeholder="ç¾å­˜" onChange={e=>setStockCounts({...stockCounts,[item.id]:e.target.value})} className="flex-1"/>
            <span className="font-bold text-red-500">+{calcNeed(item)}</span>
            <button onClick={()=>deleteItem(item.id)} className="text-red-500">âœ•</button>
          </div>
        </div>
      ))}

      <button onClick={addItem} className="w-full mt-4 p-3 bg-green-600 text-white font-bold rounded">
        â• æ–°å¢å“é …ï¼ˆå…¨è£ç½®åŒæ­¥ï¼‰
      </button>
    </div>
  );
};

ReactDOM.createRoot(document.getElementById("root")).render(<App />);
</script>
</body>
</html>
